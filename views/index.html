<!DOCTYPE html>
<html>
<head>
  <title>Opus</title>
  <style>

  .links line {
    stroke: #999;
    stroke-opacity: 0.6;
  }

  .nodes circle {
    stroke: #fff;
    stroke-width: 1.5px;
  }

  </style>
</head>
<body>
  <button id="getKanye">Get Kanye</button>
  <button id="getKanyeFriends">Get Kanye's Friends</button>
  <button id="fetchKanyeSearch">Find Kanyes with Search</button>
  <svg width="960" height="600"></svg>

 </body>

<footer>
  <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous">
  </script>

  <script type="text/javascript">
    function fetchKanyeSearch() {
      let myUrl = 'https://api.spotify.com/v1/search?query=kanye&type=artist&offset=0&limit=20';
      PingSpotifyAPIAJAX(myUrl);
    }

    function getKanye() {
      let myUrl = 'https://api.spotify.com/v1/artists/5K4W6rqBFWDnAN6FQUkS6x';
      PingSpotifyAPIAJAX(myUrl);
    }

    function getKanyeFriends() {
      let myUrl = 'https://api.spotify.com/v1/artists/5K4W6rqBFWDnAN6FQUkS6x/related-artists';
      PingSpotifyAPIAJAX(myUrl);
    }

    function PingSpotifyAPIAJAX(url) {
      $.ajax('/cors', { data: { url } }).then(
        response => {console.log(response)},
        (err) => console.error(err)
      )
    }

    $('#fetchKanyeSearch').click(fetchKanyeSearch)
    $('#getKanye').click(getKanye)
    $('#getKanyeFriends').click(getKanyeFriends)
  </script>

  <script src="https://d3js.org/d3.v4.min.js"></script>

  <script type="text/javascript">
    var svg = d3.select("svg");
      var width = +svg.attr("width");
      var height = +svg.attr("height");



    var particlesDepthBlur = function() {
      return Math.random();
    };


    function PingSpotifyAPIAJAX(url) {
      $.ajax('/cors', { data: { url } }).then(
        response => {
          console.log(response)
          console.log(url)
          let responseData;
          if (response.artists && response.artists.items) {
            responseData = response.artists.items;
          } else if (response.artists) {
            responseData = response.artists;
          } else {
            responseData = [response];
          }

          // var link = svg.append("g")
          //     .attr("class", "links")
          //     .selectAll("line")
          //     .data(graph.links)
          //     .enter().append("line")
          //     .attr("stroke-width", function(d) { return Math.sqrt(d.value); });


          var gnodes = svg.selectAll('g.gnode')
            .data(responseData, function (d) { return d.id; }) // to join the data, for transitions
            .enter()
            .append('g')
            .classed('gnode', true)

          var node = gnodes.append("circle")
              .attr("r", 7)
              .attr("fill", 'black' )
              .attr("cx", function() { return Math.random() * 720; })
              .attr("cy", function() { return Math.random() * 720; })
              // .call(d3.drag()
              //     .on("start", dragstarted)
              //     .on("drag", dragged)
              //     .on("end", dragended));


            var label = gnodes.append("text")
                .text(function(d, i) { return d.name; })
                .attr('class', 'mytext')
                //  .attr("dy", ".35em")
                .attr("text-anchor", function(d) {
                  return "start";
                })
                .style("fill", "#555")
                .style("font-family", "Arial")
                .style("font-size", 12)
                .attr("x", function() { return Math.random() * 720; })
                .attr("y", function() { return Math.random() * 720; })

            // .call(d3.drag()
            //   .on("start", dragstarted)
            //   .on("drag", dragged)
            //   .on("end", dragended));

            // node.append("title")
            //     .text(function(d) { return d.id; });

        },
        (err) => console.error(err)
      )
    }



  </script>

</footer>
</html>
